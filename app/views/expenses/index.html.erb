<h1>Expenses</h1>

<%= link_to "Add Expense", new_expense_path %>

<!-- Toggle Edit Mode -->
<button onclick="toggleEditMode()">Edit</button>

<h2>Total: ¥ <%= @total_price %></h2>

<!-- Expense List with checkboxes (visible only in edit mode) -->
<%= form_with url: edit_multiple_expenses_path, method: :post, data: { turbo: false }, id: "edit-form" do %>
  <ul>
    <% @expenses.each do |expense| %>
      <li>
        <input type="checkbox" class="edit-mode" name="selected_ids[]" value="<%= expense.id %>" style="display: none;">
        <strong><%= expense.date %></strong> -
        <%= expense.description %> -
        ¥<%= expense.price %> -
        <%= expense.category %>
      </li>
    <% end %>
  </ul>
  <!-- Edit Button (only visible in edit mode) -->
  <button type="submit" class="edit-mode" style="display: none;">Edit Selected</button>
<% end %>

<!-- DELETE FORM (independent) -->
<%= form_with url: destroy_multiple_expenses_path, method: :delete, data: { turbo: false }, id: "delete-form" do %>
  <%# Reuse same checkboxes via JS cloning or a new selection round %>
  <!-- Button appears only in edit mode -->
  <button type="submit" class="edit-mode" style="display: none;">Delete Selected</button>
<% end %>

<script>
  function toggleEditMode() {
    document.querySelectorAll('.edit-mode').forEach(el => {
      el.style.display = (el.style.display === 'none' || el.style.display === '') ? 'inline-block' : 'none';
    });
  }
</script>
